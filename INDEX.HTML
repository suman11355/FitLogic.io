 <!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BMI Calculator & Health Insights</title>
    <!-- Chosen Palette: Serene Indigo & Violet (Light) + Deep Night (Dark) -->
    
    <!-- Load Tailwind CSS with Dark Mode Configuration -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Transitions for smooth theme switching */
        body, .bmi-card, .input-dark, button, h1, h2, p, span, div {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }

        /* Professional Light Theme Styles - INDIGO/VIOLET Accent */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f5f3ff; /* Soft Violet 50 background */
            min-height: 100vh;
        }
        /* Dark Mode Background */
        .dark body {
            background-color: #0f172a; /* Slate 900 */
        }

        .bmi-card {
            background-color: #ffffff; /* Pure white cards */
            /* Subtle, clean shadow for lift */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08), 0 1px 4px rgba(0, 0, 0, 0.05);
            color: #1f2937; /* Dark text for light background (Gray 800) */
            transition: transform 0.3s ease, box-shadow 0.3s ease, background-color 0.3s ease, color 0.3s ease; /* Smooth hover transition */
        }
        /* Dark Mode Card */
        .dark .bmi-card {
            background-color: #1e293b; /* Slate 800 */
            color: #f1f5f9; /* Slate 100 */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .bmi-card:hover {
            transform: translateY(-2px); /* Subtle lift on hover */
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
        }
        .dark .bmi-card:hover {
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5);
        }

        /* Accent color for buttons (Violet) */
        .primary-accent { 
            background-color: #7c3aed; /* Tailwind violet-600 */
            color: #ffffff; /* Light text on bright button */
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .primary-accent:hover {
            background-color: #6d28d9; /* Tailwind violet-700 */
            transform: scale(1.02); /* Slight scale up on hover */
        }
        .dark .primary-accent {
            background-color: #8b5cf6; /* Violet 500 for better contrast in dark */
        }
        .dark .primary-accent:hover {
            background-color: #7c3aed; /* Violet 600 */
        }
        .primary-accent:active {
            transform: scale(0.98); /* Click feedback */
        }
        
        /* Input Field Styling for Light Theme */
        .input-dark {
            background-color: #ffffff; /* White background */
            color: #1f2937; /* Dark text */
            border-color: #d1d5db; /* Gray 300 border */
            transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.3s ease, color 0.3s ease;
        }
        /* Dark Mode Input */
        .dark .input-dark {
            background-color: #334155; /* Slate 700 */
            color: #ffffff;
            border-color: #475569; /* Slate 600 */
        }

        .input-dark:focus {
            border-color: #8b5cf6; /* Violet focus ring */
            box-shadow: 0 0 0 2px rgba(139, 92, 246, 0.5); 
            outline: none;
        }

        /* Result Box Styling */
        .result-box {
            background-color: #ffffff; /* White background */
            border-color: #e5e7eb; /* Light gray border */
        }
        .dark .result-box {
            background-color: #334155; /* Slate 700 */
            border-color: #475569;
        }

        /* Custom Animation Classes for smooth reveal */
        .animated-result {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.6s cubic-bezier(0.34, 1.56, 0.64, 1), transform 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); /* Bouncy ease */
            pointer-events: none;
        }
        .animated-result.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        /* Staggered Animation Keyframes */
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fade-in-up {
            opacity: 0; /* Start hidden */
            animation: fadeInUp 0.5s ease-out forwards;
        }

        /* Animation Delays for Staggering */
        .delay-100 { animation-delay: 0.1s; }
        .delay-200 { animation-delay: 0.2s; }
        .delay-300 { animation-delay: 0.3s; }
        .delay-400 { animation-delay: 0.4s; }
        .delay-500 { animation-delay: 0.5s; }
        .delay-600 { animation-delay: 0.6s; }
        .delay-700 { animation-delay: 0.7s; }

        /* Custom style for the BMI meter pointer */
        #bmi-pointer {
            transition: left 1s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Springy transition */
            z-index: 10;
        }

        /* Meal Plan Table Styling */
        .meal-table th {
            @apply bg-violet-50 p-3 text-violet-700 font-semibold text-left transition-colors duration-300;
        }
        .dark .meal-table th {
            @apply bg-slate-700 text-violet-300;
        }

        .meal-table td {
            @apply p-3 border-t border-violet-100 text-gray-700 transition-colors duration-300;
        }
        .dark .meal-table td {
            @apply border-slate-600 text-slate-300;
        }

        .meal-type {
            @apply font-bold text-gray-900 transition-colors duration-300;
        }
        .dark .meal-type {
            @apply text-white;
        }
    </style>
</head>
<body class="p-4 md:p-8 dark:bg-slate-950 transition-colors duration-300">

    <!-- Main Container --><div class="max-w-4xl mx-auto animate-fade-in-up">
        <header class="flex justify-between items-start mb-8">
            <div class="text-left">
                <h2 class="text-3xl font-bold text-gray-900 dark:text-white">FitLogic.io</h2>
                <p class="text-slate-600 dark:text-slate-400">Calculate your BMI and get personalized, grounded recommendations.</p>
            </div>
            <!-- Theme Toggle Button -->
            <button id="theme-toggle" class="p-2 rounded-full bg-white dark:bg-slate-800 shadow-lg border border-gray-200 dark:border-slate-700 text-gray-600 dark:text-yellow-400 hover:scale-110 transition-transform">
                <!-- Sun Icon (shown in dark mode) -->
                <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 hidden dark:block" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
                <!-- Moon Icon (shown in light mode) -->
                <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 block dark:hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                </svg>
            </button>
        </header>

        <!-- BMI Input and Calculation Section --><div class="bmi-card p-6 md:p-8 rounded-xl grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8 animate-fade-in-up delay-100">
            
            <!-- Input Form --><div class="lg:col-span-2">
                <h2 class="text-xl font-semibold mb-4 text-violet-600 dark:text-violet-400">Calculate Your Body Mass Index (BMI)</h2>
                
                <!-- Unit System Toggle --><div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2">Measurement System</label>
                    <div class="flex bg-gray-200 dark:bg-slate-700 p-1 rounded-lg">
                        <button id="unit-metric" data-unit="metric" class="unit-toggle w-1/2 py-2 px-4 rounded-lg font-semibold text-white bg-violet-600 transition duration-300">Metric (kg/cm)</button>
                        <button id="unit-imperial" data-unit="imperial" class="unit-toggle w-1/2 py-2 px-4 rounded-lg font-semibold text-gray-700 dark:text-slate-300 hover:bg-gray-300 dark:hover:bg-slate-600 transition duration-300">US Standard (lb/ft/in)</button>
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                    <!-- Age Input --><div>
                        <label for="age" class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1">Age (Years)</label>
                        <input type="number" id="age" placeholder="e.g., 30" min="1" max="120" class="w-full p-3 border input-dark rounded-lg focus:ring-violet-500 focus:border-violet-500 transition duration-150" required>
                    </div>
                    <!-- Gender Input --><div>
                        <label for="gender" class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1">Gender</label>
                        <select id="gender" class="w-full p-3 border input-dark rounded-lg focus:ring-violet-500 focus:border-violet-500 transition duration-150">
                            <option value="not specified">Prefer not to specify</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                        </select>
                    </div>
                </div>
                
                <!-- Main Measurements --><div class="grid grid-cols-1 sm:grid-cols-2 gap-4"> <!-- Weight Input --><div>
                        <label for="weight" id="weight-label" class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1">Weight (kg)</label>
                        <input type="number" id="weight" placeholder="e.g., 75" min="1" class="w-full p-3 border input-dark rounded-lg focus:ring-violet-500 focus:border-violet-500 transition duration-150" required>
                    </div>

                    <!-- Height Input (Metric) --><div id="height-metric-group">
                        <label for="height-cm" id="height-cm-label" class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1">Height (cm)</label>
                        <input type="number" id="height-cm" placeholder="e.g., 175" min="1" class="w-full p-3 border input-dark rounded-lg focus:ring-violet-500 focus:border-violet-500 transition duration-150">
                    </div>
                    <!-- Height Input (Imperial - Two columns) --><div id="height-imperial-group" class="grid grid-cols-2 gap-2" style="display: none;">
                        <div>
                            <label for="height-ft" class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1">Height (ft)</label>
                            <input type="number" id="height-ft" placeholder="5" min="0" max="8" class="w-full p-3 border input-dark rounded-lg focus:ring-violet-500 focus:border-violet-500 transition duration-150">
                        </div>
                        <div>
                            <label for="height-in" class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-1">Height (in)</label>
                            <input type="number" id="height-in" placeholder="10" min="0" max="11" class="w-full p-3 border input-dark rounded-lg focus:ring-violet-500 focus:border-violet-500 transition duration-150">
                        </div>
                    </div>
                </div>

                <!-- Calculate Button --><button id="calculate-btn" class="w-full primary-accent text-lg font-bold py-3 mt-6 rounded-lg shadow-lg hover:shadow-xl transition duration-300 ease-in-out disabled:bg-gray-400 disabled:text-gray-200">
                    Calculate BMI & Get Insights
                </button>
            </div>

            <!-- Result Display --><div id="result-display" class="animated-result lg:col-span-1">
                <h2 class="text-xl font-semibold mb-4 text-violet-600 dark:text-violet-400">Your Result</h2>
                
                <!-- New Visual Meter Container --><div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 dark:text-slate-300 mb-2">BMI Visual Meter</label>
                    <div class="h-6 w-full bg-red-400 flex rounded-full overflow-hidden relative shadow-inner">
                        <!-- Underweight segment (Amber) - 15.0 to 18.5 --><div class="bg-amber-400 h-full" id="meter-underweight-segment"></div>
                        <!-- Healthy Range (Green) - 18.5 to 24.9 --><div class="bg-emerald-400 h-full" id="meter-healthy-segment"></div> 
                        <!-- Overweight Range (Orange) - 25.0 to 29.9 --><div class="bg-orange-400 h-full" id="meter-overweight-segment"></div>
                        <!-- Pointer (Needle) --><div class="absolute top-0 h-full w-0.5 bg-gray-900 dark:bg-white shadow-lg" id="bmi-pointer"></div>
                    </div>
                    <div class="flex justify-between text-xs text-gray-600 dark:text-slate-400 mt-1">
                        <span>15</span>
                        <span style="position: absolute; left: calc( (18.5 - 15) / 25 * 100% - 10px); top: 0;">18.5</span>
                        <span style="position: absolute; left: calc( (24.9 - 15) / 25 * 100% - 10px); top: 0;">24.9</span>
                        <span style="position: absolute; left: calc( (29.9 - 15) / 25 * 100% - 10px); top: 0;">29.9</span>
                        <span style="position: absolute; right: 0;">40+</span>
                    </div>
                </div>

                <div class="result-box p-6 rounded-xl border-2">
                    <p class="text-gray-600 dark:text-slate-400 mb-2">Your BMI Score:</p>
                    <p id="bmi-score" class="text-5xl font-extrabold text-violet-600 dark:text-violet-400 mb-4 transition duration-500">0.0</p>
                    <p id="bmi-category" class="text-lg font-semibold text-gray-900 dark:text-white">Enter your data above to begin.</p>
                    <div id="healthy-range" class="text-sm text-gray-600 dark:text-slate-400 mt-2"></div>

                    <!-- New: TTS Feature Button (Enabled after calculation) -->
                    <button id="tts-btn" class="mt-4 w-full py-2 px-4 rounded-lg text-white bg-violet-600 font-semibold flex items-center justify-center transition disabled:bg-gray-400 hover:bg-violet-700 dark:disabled:bg-slate-700" disabled>
                        <span id="tts-text-normal">Listen to a Health Fact ðŸŽ§</span>
                        <span id="tts-text-loading" class="hidden flex items-center text-white">
                            Speaking...
                        </span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Recommendations and Insights Section --><div id="recommendations-section" class="bmi-card p-6 md:p-8 rounded-xl animated-result">
            <h2 class="text-xl font-semibold mb-4 text-violet-600 dark:text-violet-400 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 text-violet-600 dark:text-violet-400 mr-2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3m-3 0h5m-5 0h7m-7 0h9m-9 0h11m-11 0h13m-13 0h15m-15 0h17M3 10V4a2 2 0 012-2h14a2 2 0 012 2v6m-4 10H7a2 2 0 01-2-2v-4a2 2 0 012-2h10a2 2 0 012 2v4a2 2 0 01-2 2z" />
                </svg>
                Personalized Health Insights
            </h2>
            <div id="insights-content" class="text-gray-700 dark:text-slate-300">
                <!-- Initial content will be set here by JS --></div>
        </div>
        
        <!-- New: Meal Plan Section -->
        <div id="meal-plan-section" class="bmi-card p-6 md:p-8 rounded-xl mt-8 animate-fade-in-up delay-200">
            <h2 class="text-xl font-semibold mb-4 text-violet-600 dark:text-violet-400 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6 text-violet-600 dark:text-violet-400 mr-2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 21v-8.25M15.75 21v-8.25M12 21H6m6 0h6m-3-6h.008v.008H15V15zm0 0l-3-3m-3 3l3-3m0 0l3 3m-3-3V3m0 0l3 3m-3-3l-3 3"/>
                </svg>
                Custom 7-Day Meal Planner
            </h2>
            <button id="generate-meal-plan-btn" class="w-full py-3 px-4 rounded-lg text-white bg-violet-600 font-bold shadow-lg hover:shadow-xl transition disabled:bg-gray-400 dark:disabled:bg-slate-700" disabled>
                Generate 7-Day Meal Plan
            </button>
            <div id="meal-plan-output" class="mt-6 text-gray-700 dark:text-slate-300">
                <p class="text-center text-gray-600 dark:text-slate-400">Calculate your BMI first to enable the meal planner.</p>
            </div>
        </div>
    </div>
    
    <!-- Footer Section --><footer class="text-center mt-12 pb-8 animate-fade-in-up delay-300">
        <p class="text-sm text-gray-500 dark:text-slate-500">
            Made by <span class="font-semibold text-violet-600 dark:text-violet-400">Suman</span>
        </p>
    </footer>

    <!-- JavaScript Logic --><script type="module">
        // State for Unit System
        let currentUnit = 'metric'; // Default unit system
        let lastBMICategory = ''; // Stores the last calculated category for meal plan generation

        // --- Theme Management ---
        const htmlElement = document.documentElement;
        const themeToggleBtn = document.getElementById('theme-toggle');

        // Check for saved user preference, if any, on load
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            htmlElement.classList.add('dark');
        } else {
            htmlElement.classList.remove('dark');
        }

        themeToggleBtn.addEventListener('click', () => {
            if (htmlElement.classList.contains('dark')) {
                htmlElement.classList.remove('dark');
                localStorage.theme = 'light';
            } else {
                htmlElement.classList.add('dark');
                localStorage.theme = 'dark';
            }
        });

        // --- DOM Elements ---
        const ageInput = document.getElementById('age');
        const genderSelect = document.getElementById('gender');
        const weightInput = document.getElementById('weight');
        const weightLabel = document.getElementById('weight-label');
        const calculateBtn = document.getElementById('calculate-btn');
        const bmiScoreEl = document.getElementById('bmi-score');
        const bmiCategoryEl = document.getElementById('bmi-category');
        const healthyRangeEl = document.getElementById('healthy-range');
        const insightsContentEl = document.getElementById('insights-content');
        const resultDisplay = document.getElementById('result-display');
        const recommendationsSection = document.getElementById('recommendations-section');
        const bmiPointer = document.getElementById('bmi-pointer'); 
        
        // New Feature DOM elements
        const ttsBtn = document.getElementById('tts-btn');
        const ttsTextNormal = document.getElementById('tts-text-normal');
        const ttsTextLoading = document.getElementById('tts-text-loading');
        const generateMealPlanBtn = document.getElementById('generate-meal-plan-btn');
        const mealPlanOutput = document.getElementById('meal-plan-output');

        // Height Fields
        const heightCmInput = document.getElementById('height-cm');
        const heightMetricGroup = document.getElementById('height-metric-group');
        const heightCmLabel = document.getElementById('height-cm-label');
        const heightFtInput = document.getElementById('height-ft');
        const heightInInput = document.getElementById('height-in');
        const heightImperialGroup = document.getElementById('height-imperial-group');
        
        // Meter Segments 
        const meterUnderweight = document.getElementById('meter-underweight-segment');
        const meterHealthy = document.getElementById('meter-healthy-segment');
        const meterOverweight = document.getElementById('meter-overweight-segment');
        
        // Unit Toggle Buttons
        const unitMetricBtn = document.getElementById('unit-metric');
        const unitImperialBtn = document.getElementById('unit-imperial');

        // BMI Categories for Meter (normalized to a visible range of 15-40)
        const MIN_BMI_METER = 15.0;
        const MAX_BMI_METER = 40.0;
        const BMI_RANGE = MAX_BMI_METER - MIN_BMI_METER;
        const HEALTHY_MIN = 18.5;
        const HEALTHY_MAX = 24.9;
        const OVERWEIGHT_MAX = 29.9;

        // Calculate segment widths based on the 15-40 range
        const underweightWidth = ((HEALTHY_MIN - MIN_BMI_METER) / BMI_RANGE) * 100; 
        const healthyWidth = ((HEALTHY_MAX - HEALTHY_MIN) / BMI_RANGE) * 100; 
        const overweightWidth = ((OVERWEIGHT_MAX - HEALTHY_MAX) / BMI_RANGE) * 100;
        
        // Set the fixed meter segment widths on load
        meterUnderweight.style.width = `${underweightWidth}%`;
        meterHealthy.style.width = `${healthyWidth}%`;
        meterOverweight.style.width = `${overweightWidth}%`;

        // --- STATIC DATA (No AI) ---

        const staticInsights = {
            "Underweight": {
                summary: "Focus on nutrient-dense foods to build strength safely.",
                recommendations: [
                    "Eat more frequently (5-6 small meals daily).",
                    "Choose energy-dense foods like nuts, avocados, and healthy oils.",
                    "Include a source of protein with every meal.",
                    "Incorporate strength training to build muscle, not just fat."
                ],
                fact: "Being underweight can weaken your immune system and reduce energy levels."
            },
            "Healthy Weight": {
                summary: "Great job! Focus on maintaining your current habits for long-term health.",
                recommendations: [
                    "Continue eating a balanced diet rich in fruits and vegetables.",
                    "Stay hydrated and drink plenty of water.",
                    "Aim for at least 150 minutes of moderate activity per week.",
                    "Prioritize sleep and stress management."
                ],
                fact: "Maintaining a healthy weight significantly reduces the risk of chronic diseases."
            },
            "Overweight": {
                summary: "Small, sustainable changes can lead to big health improvements.",
                recommendations: [
                    "Practice portion control and mindful eating.",
                    "Increase your daily step count and general movement.",
                    "Limit sugary beverages and refined carbohydrates.",
                    "Fill half your plate with vegetables at every meal."
                ],
                fact: "Losing just 5-10% of body weight can significantly improve blood pressure and cholesterol."
            },
            "Obesity": {
                summary: "Focus on sustainable lifestyle changes rather than quick fixes.",
                recommendations: [
                    "Consult a healthcare provider for a personalized plan.",
                    "Focus on whole, unprocessed foods over processed snacks.",
                    "Start with low-impact exercises like walking or swimming.",
                    "Track your meals to become aware of eating patterns."
                ],
                fact: "Obesity is a complex condition influenced by genetics, environment, and metabolism, not just willpower."
            }
        };

        const staticMealPlans = {
            "Underweight": [
                { day: "Day 1", goal: "Caloric Surplus", meals: [ { type: "Breakfast", item: "Oatmeal with nuts & banana", description: "High calorie & carb" }, { type: "Lunch", item: "Chicken Avocado Wrap", description: "Healthy fats & protein" }, { type: "Dinner", item: "Salmon with Quinoa", description: "Nutrient dense" }, { type: "Snack", item: "Greek Yogurt & Honey", description: "Protein boost" } ] },
                { day: "Day 2", goal: "Caloric Surplus", meals: [ { type: "Breakfast", item: "Avocado Toast with Eggs", description: "Healthy fats" }, { type: "Lunch", item: "Pasta with Meat Sauce", description: "Carb heavy" }, { type: "Dinner", item: "Steak and Potatoes", description: "High protein & calorie" }, { type: "Snack", item: "Trail Mix", description: "Energy density" } ] },
                { day: "Day 3", goal: "Caloric Surplus", meals: [ { type: "Breakfast", item: "Smoothie with Peanut Butter", description: "Easy calories" }, { type: "Lunch", item: "Turkey Club Sandwich", description: "Balanced meal" }, { type: "Dinner", item: "Chicken Curry with Rice", description: "Flavorful surplus" }, { type: "Snack", item: "Cheese and Crackers", description: "Easy snack" } ] },
                { day: "Day 4", goal: "Caloric Surplus", meals: [ { type: "Breakfast", item: "Bagel with Cream Cheese", description: "Dense carbs" }, { type: "Lunch", item: "Burrito Bowl with Guacamole", description: "Calorie rich" }, { type: "Dinner", item: "Beef Stir Fry", description: "Protein & veg" }, { type: "Snack", item: "Protein Shake", description: "Supplement" } ] },
                { day: "Day 5", goal: "Caloric Surplus", meals: [ { type: "Breakfast", item: "Pancakes with Syrup", description: "Carb load" }, { type: "Lunch", item: "Tuna Salad Sandwich", description: "Protein focus" }, { type: "Dinner", item: "Lasagna", description: "Hearty meal" }, { type: "Snack", item: "Dark Chocolate & Nuts", description: "Healthy fats" } ] },
                { day: "Day 6", goal: "Caloric Surplus", meals: [ { type: "Breakfast", item: "Full English Breakfast", description: "High calorie start" }, { type: "Lunch", item: "Chicken Caesar Wrap", description: "Good fats" }, { type: "Dinner", item: "Lamb Chops with Mash", description: "Protein dense" }, { type: "Snack", item: "Fruit Smoothie", description: "Vitamins" } ] },
                { day: "Day 7", goal: "Caloric Surplus", meals: [ { type: "Breakfast", item: "French Toast", description: "Tasty carbs" }, { type: "Lunch", item: "Burger and Sweet Potato Fries", description: "Treat meal" }, { type: "Dinner", item: "Roast Chicken Dinner", description: "Balanced surplus" }, { type: "Snack", item: "Granola Bar", description: "Quick energy" } ] }
            ],
            "Healthy Weight": [
                { day: "Day 1", goal: "Maintenance", meals: [ { type: "Breakfast", item: "Scrambled Eggs & Toast", description: "Balanced protein/carb" }, { type: "Lunch", item: "Grilled Chicken Salad", description: "Lean protein & veg" }, { type: "Dinner", item: "Baked Cod with Veggies", description: "Light & nutritious" }, { type: "Snack", item: "Apple & Almonds", description: "Fiber & fat" } ] },
                { day: "Day 2", goal: "Maintenance", meals: [ { type: "Breakfast", item: "Greek Yogurt Parfait", description: "Probiotics & protein" }, { type: "Lunch", item: "Turkey & Cheese Roll-ups", description: "Low carb lunch" }, { type: "Dinner", item: "Spaghetti Bolognese", description: "Comfort food" }, { type: "Snack", item: "Carrot Sticks & Hummus", description: "Crunchy snack" } ] },
                { day: "Day 3", goal: "Maintenance", meals: [ { type: "Breakfast", item: "Oatmeal with Berries", description: "Fiber rich" }, { type: "Lunch", item: "Lentil Soup", description: "Plant protein" }, { type: "Dinner", item: "Grilled Steak & Salad", description: "High protein" }, { type: "Snack", item: "Hard Boiled Egg", description: "Protein snack" } ] },
                { day: "Day 4", goal: "Maintenance", meals: [ { type: "Breakfast", item: "Smoothie Bowl", description: "Nutrient dense" }, { type: "Lunch", item: "Quinoa Salad", description: "Complex carbs" }, { type: "Dinner", item: "Chicken Stir Fry", description: "Lean dinner" }, { type: "Snack", item: "Pear", description: "Simple fruit" } ] },
                { day: "Day 5", goal: "Maintenance", meals: [ { type: "Breakfast", item: "Whole Wheat Toast & PB", description: "Sustained energy" }, { type: "Lunch", item: "Tuna Nicoise Salad", description: "Omega-3s" }, { type: "Dinner", item: "Tacos (Lean Beef)", description: "Fun meal" }, { type: "Snack", item: "Popcorn (Air popped)", description: "Whole grain" } ] },
                { day: "Day 6", goal: "Maintenance", meals: [ { type: "Breakfast", item: "Veggie Omelet", description: "Vitamins & protein" }, { type: "Lunch", item: "Chicken Pesto Pasta", description: "Balanced meal" }, { type: "Dinner", item: "Shrimp Scampi", description: "Seafood" }, { type: "Snack", item: "Cottage Cheese", description: "Slow digest protein" } ] },
                { day: "Day 7", goal: "Maintenance", meals: [ { type: "Breakfast", item: "Waffles (Whole Grain)", description: "Weekend breakfast" }, { type: "Lunch", item: "Caprese Salad", description: "Fresh & light" }, { type: "Dinner", item: "Roast Beef & Veggies", description: "Sunday dinner" }, { type: "Snack", item: "Orange", description: "Vitamin C" } ] }
            ],
            "Overweight": [
                { day: "Day 1", goal: "Caloric Deficit", meals: [ { type: "Breakfast", item: "Egg White Omelet", description: "High protein, low fat" }, { type: "Lunch", item: "Grilled Chicken over Greens", description: "Volume eating" }, { type: "Dinner", item: "Zucchini Noodles with Marinara", description: "Low carb sub" }, { type: "Snack", item: "Celery & Hummus", description: "Low cal crunch" } ] },
                { day: "Day 2", goal: "Caloric Deficit", meals: [ { type: "Breakfast", item: "Protein Shake", description: "Meal replacement" }, { type: "Lunch", item: "Turkey Lettuce Wraps", description: "No bread lunch" }, { type: "Dinner", item: "Baked Salmon & Asparagus", description: "Healthy fats" }, { type: "Snack", item: "Berries", description: "Low sugar fruit" } ] },
                { day: "Day 3", goal: "Caloric Deficit", meals: [ { type: "Breakfast", item: "Cottage Cheese & Pineapple", description: "High protein" }, { type: "Lunch", item: "Vegetable Soup", description: "Filling fluid" }, { type: "Dinner", item: "Grilled White Fish", description: "Very lean protein" }, { type: "Snack", item: "Almonds (Portioned)", description: "Healthy fat" } ] },
                { day: "Day 4", goal: "Caloric Deficit", meals: [ { type: "Breakfast", item: "Oatmeal (Water base)", description: "Fiber for fullness" }, { type: "Lunch", item: "Tuna Salad (Light Mayo)", description: "Lean protein" }, { type: "Dinner", item: "Chicken Breast & Broccoli", description: "Staple lean meal" }, { type: "Snack", item: "Cucumber Slices", description: "Hydrating" } ] },
                { day: "Day 5", goal: "Caloric Deficit", meals: [ { type: "Breakfast", item: "Green Smoothie", description: "Nutrient bomb" }, { type: "Lunch", item: "Hard Boiled Eggs & Spinach", description: "Simple protein" }, { type: "Dinner", item: "Turkey Chili (Beanless)", description: "High protein" }, { type: "Snack", item: "Rice Cake", description: "Low cal carb" } ] },
                { day: "Day 6", goal: "Caloric Deficit", meals: [ { type: "Breakfast", item: "Greek Yogurt (0% fat)", description: "Pure protein" }, { type: "Lunch", item: "Sashimi / Sushi Roll (no mayo)", description: "Clean eating" }, { type: "Dinner", item: "Stir Fry Veggies & Tofu", description: "Plant based light" }, { type: "Snack", item: "Grapefruit", description: "Metabolism aid" } ] },
                { day: "Day 7", goal: "Caloric Deficit", meals: [ { type: "Breakfast", item: "Poached Eggs on Greens", description: "Savory start" }, { type: "Lunch", item: "Grilled Shrimp Salad", description: "Low cal protein" }, { type: "Dinner", item: "Lean Steak & Green Beans", description: "Satisfying dinner" }, { type: "Snack", item: "Tea & Dark Chocolate square", description: "Small treat" } ] }
            ]
        };
        // Map Obesity to Overweight plan for simplicity in this static version
        staticMealPlans["Obesity"] = staticMealPlans["Overweight"];

        const staticHealthFacts = [
            "Did you know? Muscle tissue burns more calories at rest than fat tissue, so strength training helps metabolism.",
            "Staying hydrated is crucial. Sometimes your body confuses thirst for hunger.",
            "Eating slowly gives your brain time to register that you are full, preventing overeating.",
            "Fiber-rich foods like oats and vegetables keep you feeling full for longer.",
            "Sleep deprivation can increase hunger hormones, making it harder to manage weight.",
            "Walking just 30 minutes a day can significantly improve cardiovascular health."
        ];

        // --- Utility Functions ---

        function switchUnits(unit) {
            currentUnit = unit;
            
            if (unit === 'metric') {
                unitMetricBtn.classList.add('bg-violet-600', 'text-white');
                unitMetricBtn.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300', 'dark:bg-slate-700', 'dark:text-slate-300', 'dark:hover:bg-slate-600');
                unitImperialBtn.classList.remove('bg-violet-600', 'text-white');
                unitImperialBtn.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300', 'dark:bg-slate-700', 'dark:text-slate-300', 'dark:hover:bg-slate-600');
                
                heightMetricGroup.style.display = 'block';
                heightImperialGroup.style.display = 'none';
                
                weightLabel.textContent = 'Weight (kg)';
                weightInput.placeholder = 'e.g., 75';

                heightFtInput.value = '';
                heightInInput.value = '';
                
            } else { // imperial
                unitImperialBtn.classList.add('bg-violet-600', 'text-white');
                unitImperialBtn.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300', 'dark:bg-slate-700', 'dark:text-slate-300', 'dark:hover:bg-slate-600');
                unitMetricBtn.classList.remove('bg-violet-600', 'text-white');
                unitMetricBtn.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300', 'dark:bg-slate-700', 'dark:text-slate-300', 'dark:hover:bg-slate-600');

                heightMetricGroup.style.display = 'none';
                heightImperialGroup.style.display = 'grid';

                weightLabel.textContent = 'Weight (lb)';
                weightInput.placeholder = 'e.g., 165';

                heightCmInput.value = '';
            }
        }

        function imperialToInches(ft, inch) {
            return (ft * 12) + inch;
        }

        function calculateBMI(weight, heightA, heightB = 0) {
            if (currentUnit === 'metric') {
                // Metric: kg / m^2
                const heightM = heightA / 100; 
                return weight / (heightM * heightM);
            } else {
                // Imperial: (lb / in^2) * 703
                const totalInches = imperialToInches(heightB, heightA);
                return (weight / (totalInches * totalInches)) * 703;
            }
        }

        function getBMICategory(bmi) {
            let category, color;
            if (bmi < 18.5) {
                category = "Underweight";
                color = "text-amber-600 dark:text-amber-400"; 
            } else if (bmi >= 18.5 && bmi <= 24.9) {
                category = "Healthy Weight";
                color = "text-emerald-600 dark:text-emerald-400"; 
            } else if (bmi >= 25.0 && bmi <= 29.9) {
                category = "Overweight";
                color = "text-orange-600 dark:text-orange-400"; 
            } else { // bmi >= 30.0
                category = "Obesity";
                color = "text-red-600 dark:text-red-400"; 
            }
            return { category, color };
        }
        
        function calculateHealthyRange(heightA, heightB = 0) {
            let h2;
            let unit = currentUnit === 'metric' ? 'kg' : 'lb';

            if (currentUnit === 'metric') {
                const heightM = heightA / 100;
                h2 = heightM * heightM;
                // Min/Max BMI * m^2
                const minWeight = 18.5 * h2;
                const maxWeight = 24.9 * h2;
                return { min: minWeight.toFixed(1), max: maxWeight.toFixed(1), unit };

            } else {
                const totalInches = imperialToInches(heightB, heightA);
                h2 = totalInches * totalInches;
                // (Min/Max BMI / 703) * in^2
                const conversionFactor = 703;
                const minWeight = (18.5 / conversionFactor) * h2;
                const maxWeight = (24.9 / conversionFactor) * h2;
                return { min: minWeight.toFixed(1), max: maxWeight.toFixed(1), unit };
            }
        }

        function updateBMIMeter(bmi) {
            let pointerPosition;

            if (bmi <= MIN_BMI_METER) {
                // Capped at the start
                pointerPosition = 0;
            } else if (bmi >= MAX_BMI_METER) {
                // Capped at the end
                pointerPosition = 100;
            } else {
                // Calculate position percentage within the range 15 to 40
                pointerPosition = ((bmi - MIN_BMI_METER) / BMI_RANGE) * 100;
            }
            
            bmiPointer.style.left = `calc(${pointerPosition}% - 0.25px)`; 
        }

        // --- STATIC INSIGHTS LOGIC ---

        function generateRecommendation(bmi, category, age, gender) { 
            insightsContentEl.innerHTML = `
                <div class="flex items-center justify-center py-6 text-violet-600 dark:text-violet-400">
                    <svg class="animate-spin h-8 w-8 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="font-medium">Analyzing data...</p>
                </div>
            `;
            calculateBtn.disabled = true;
            recommendationsSection.classList.remove('show');

            // Simulate delay
            setTimeout(() => {
                const insights = staticInsights[category];
                if (!insights) {
                    insightsContentEl.innerHTML = `<p class="text-red-500">Could not generate insights.</p>`;
                    calculateBtn.disabled = false;
                    return;
                }

                let sourceHtml = `
                    <div class="mt-6 pt-4 border-t border-gray-200 dark:border-gray-700 text-sm text-gray-500 dark:text-slate-400 animate-fade-in-up delay-300">
                        <p class="font-medium mb-2">General Health Guidelines:</p>
                        <ul class="list-disc ml-5 space-y-1">
                            <li>Standard BMI categories (WHO/CDC).</li>
                            <li>Consult a doctor for personalized medical advice.</li>
                        </ul>
                    </div>
                `;

                insightsContentEl.innerHTML = `
                    <div class="prose max-w-none text-gray-700 dark:text-slate-300">
                        <p class="font-semibold text-lg mb-2 animate-fade-in-up delay-100">${insights.summary}</p>
                        <ul class="list-disc ml-5 mb-4 animate-fade-in-up delay-200">
                            ${insights.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                        </ul>
                        <div class="bg-violet-50 dark:bg-slate-800 p-3 rounded border border-violet-100 dark:border-slate-700 text-violet-800 dark:text-violet-300 text-sm animate-fade-in-up delay-300">
                            <strong>Did you know?</strong> ${insights.fact}
                        </div>
                    </div>
                    ${sourceHtml}
                `;
                
                recommendationsSection.classList.add('show');
                calculateBtn.disabled = false;
            }, 600);
        }

        // --- STATIC MEAL PLAN LOGIC ---

        async function generateMealPlan() {
            generateMealPlanBtn.disabled = true;
            
            mealPlanOutput.innerHTML = `
                <div class="flex items-center justify-center py-6 text-violet-600 dark:text-violet-400">
                    <svg class="animate-spin h-8 w-8 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="font-medium">Creating your personalized 7-day meal plan...</p>
                </div>
            `;
            
            await new Promise(r => setTimeout(r, 500));

            try {
                let planKey = lastBMICategory;
                if (!staticMealPlans[planKey]) {
                    if (planKey === 'Obesity') planKey = 'Overweight';
                    else planKey = 'Healthy Weight';
                }

                const mealPlan = staticMealPlans[planKey];
                
                let html = '';
                mealPlan.forEach((dayPlan, index) => {
                    const delayClass = `delay-${Math.min((index + 1) * 100, 700)}`; // Stagger effect
                    html += `
                        <div class="mb-8 animate-fade-in-up ${delayClass}">
                            <h3 class="text-xl font-bold text-violet-600 dark:text-violet-400 mb-2">${dayPlan.day}</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Goal: ${dayPlan.goal}</p>
                            <div class="overflow-x-auto">
                                <table class="meal-table w-full rounded-lg overflow-hidden">
                                    <thead>
                                        <tr>
                                            <th class="w-1/4">Meal</th>
                                            <th class="w-1/3">Item</th>
                                            <th>Description</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${dayPlan.meals.map(meal => `
                                            <tr>
                                                <td class="meal-type text-sm">${meal.type}</td>
                                                <td class="font-medium text-gray-800 dark:text-slate-200">${meal.item}</td>
                                                <td class="text-sm text-gray-600 dark:text-slate-400">${meal.description}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    `;
                });

                mealPlanOutput.innerHTML = html;

            } catch (error) {
                mealPlanOutput.innerHTML = `
                    <div class="bg-red-100 border border-red-400 text-red-700 p-4 rounded-lg">
                        <p class="font-bold">Error retrieving Meal Plan.</p>
                    </div>
                `;
            } finally {
                generateMealPlanBtn.disabled = false;
            }
        }

        // --- NATIVE BROWSER TTS LOGIC ---

        function playHealthFact() {
            ttsBtn.disabled = true;
            ttsTextNormal.classList.add('hidden');
            ttsTextLoading.classList.remove('hidden');

            // Pick a random fact
            const randomFact = staticHealthFacts[Math.floor(Math.random() * staticHealthFacts.length)];

            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(randomFact);
                utterance.lang = 'en-US';
                utterance.rate = 1; // Normal speed
                
                // Try to set a pleasant voice if available
                const voices = window.speechSynthesis.getVoices();
                // Prefer a female voice for "Assistant" feel if possible (optional polish)
                const preferredVoice = voices.find(voice => voice.name.includes('Female') || voice.name.includes('Samantha') || voice.name.includes('Google US English'));
                if (preferredVoice) utterance.voice = preferredVoice;

                utterance.onend = () => {
                    ttsBtn.disabled = false;
                    ttsTextNormal.classList.remove('hidden');
                    ttsTextLoading.classList.add('hidden');
                };

                utterance.onerror = (e) => {
                    console.error("TTS Error:", e);
                    ttsBtn.disabled = false;
                    ttsTextNormal.classList.remove('hidden');
                    ttsTextLoading.classList.add('hidden');
                };

                window.speechSynthesis.speak(utterance);
            } else {
                alert("Sorry, your browser does not support Text-to-Speech.");
                ttsBtn.disabled = false;
                ttsTextNormal.classList.remove('hidden');
                ttsTextLoading.classList.add('hidden');
            }
        }


        // --- Main Controller ---

        function handleCalculation() {
            const weight = parseFloat(weightInput.value);
            const age = parseInt(ageInput.value);
            const gender = genderSelect.value;
            
            let heightA, heightB = 0; 

            let isValid = true;
            let errorMsg = '';

            // Height validation
            if (currentUnit === 'metric') {
                heightA = parseFloat(heightCmInput.value);
                if (isNaN(heightA) || heightA <= 0) {
                    isValid = false;
                    errorMsg = 'Please enter a valid height in centimeters.';
                }
            } else {
                const ft = parseInt(heightFtInput.value || 0);
                const inch = parseInt(heightInInput.value || 0);
                heightB = ft;
                heightA = inch; 
                if (isNaN(ft) || isNaN(inch) || (ft === 0 && inch === 0)) {
                    isValid = false;
                    errorMsg = 'Please enter a valid height in feet and inches.';
                }
            }

            // General validation
            if (isNaN(weight) || weight <= 0) {
                isValid = false;
                errorMsg = 'Please enter a valid weight.';
            }
            if (isNaN(age) || age < 1 || age > 120) {
                isValid = false;
                errorMsg = 'Please enter a valid age (1-120).';
            }
            
            resultDisplay.classList.remove('show');
            recommendationsSection.classList.remove('show');

            ttsBtn.disabled = true;
            generateMealPlanBtn.disabled = true;

            if (!isValid) {
                bmiScoreEl.textContent = 'Invalid Input';
                bmiScoreEl.className = 'text-5xl font-extrabold text-red-600 dark:text-red-400 mb-4 transition duration-500';
                bmiCategoryEl.textContent = errorMsg;
                healthyRangeEl.innerHTML = '';
                insightsContentEl.innerHTML = `<div class="bg-red-100 border border-red-400 text-red-700 dark:bg-red-900/30 dark:text-red-300 dark:border-red-800 p-4 rounded-lg">Validation Error: ${errorMsg}</div>`;
                mealPlanOutput.innerHTML = `<p class="text-center text-red-700 dark:text-red-400">Fix validation errors to enable features.</p>`;
                resultDisplay.classList.add('show');
                return;
            }

            // 1. Calculate BMI
            const bmi = calculateBMI(weight, heightA, heightB); 
            const { category, color } = getBMICategory(bmi);
            const healthyRange = calculateHealthyRange(heightA, heightB);
            lastBMICategory = category; 

            // 2. Update UI
            bmiScoreEl.textContent = bmi.toFixed(1);
            bmiScoreEl.className = `text-5xl font-extrabold ${color} mb-4 transition duration-500`;
            bmiCategoryEl.textContent = `Classification: ${category}`;
            healthyRangeEl.innerHTML = `
                Healthy range (18.5 - 24.9) is:
                <span class="font-bold text-gray-900 dark:text-white">${healthyRange.min} - ${healthyRange.max} ${healthyRange.unit}</span>.
            `;
            
            setTimeout(() => {
                resultDisplay.classList.add('show');
                updateBMIMeter(bmi); 
                ttsBtn.disabled = false; 
                generateMealPlanBtn.disabled = false; 
                mealPlanOutput.innerHTML = `<p class="text-center text-gray-600 dark:text-gray-400">Click 'Generate 7-Day Meal Plan' above.</p>`;
            }, 50);

            // 3. Generate Recommendations (Static)
            generateRecommendation(bmi, category, age, gender);
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
             bmiPointer.style.left = `calc(0% - 0.25px)`;
             insightsContentEl.innerHTML = `<div class="text-center py-4 text-gray-600 dark:text-gray-400">Enter your details and click 'Calculate' to receive your personalized health insights!</div>`;
             
             calculateBtn.addEventListener('click', handleCalculation);
             unitMetricBtn.addEventListener('click', () => switchUnits('metric'));
             unitImperialBtn.addEventListener('click', () => switchUnits('imperial'));
             ttsBtn.addEventListener('click', playHealthFact);
             generateMealPlanBtn.addEventListener('click', generateMealPlan);

             switchUnits(currentUnit);
        });

    </script>
</body>
</html>